"use strict";(self.webpackChunkfluidhost=self.webpackChunkfluidhost||[]).push([[9110],{48278:function(e,n,t){t.r(n),t.d(n,{getCardChanelProvider:function(){return ee},getCodeLoaderFactory:function(){return te},getMetaOSProvider:function(){return ne},getUrlHandlerProvider:function(){return ie}});var r=t(74165),i=t(15861),a=t(52820),o=t(17842),u=t(15671),s=t(43144);function l(e){var n,t,r,i,a,o,u,s,l,c,d,p,v,f,h,w,y,x,k,g=e.titleDefinition,Z="string"===typeof e.titleId?e.titleId:e.titleId.id,b=null===g||void 0===g?void 0:g.elementDefinitions;if(Array.isArray(b)){var m=b.find((function(e){return"ComposeExtensions"===e.elementType}));if(null!==m&&void 0!==m&&m.definition){var I=JSON.parse(m.definition);x=Array.isArray(I)?I:[I]}}else x=null===b||void 0===b?void 0:b.composeExtensions;switch(null===e||void 0===e||null===(n=e.acquisitionState)||void 0===n?void 0:n.toLowerCase()){case"acquired":case"needsconsentforupgrade":default:k="installed";break;case"blocked":k="blocked";break;case"unacquired":k="notinstalled"}return{id:null!==(t=e.appId)&&void 0!==t?t:"",manifestVersion:null!==(r=null===g||void 0===g?void 0:g.manifestVersion)&&void 0!==r?r:"",version:null===g||void 0===g?void 0:g.version,categories:null!==(i=null===g||void 0===g?void 0:g.categories)&&void 0!==i?i:[],developerName:null!==(a=null===g||void 0===g?void 0:g.developerName)&&void 0!==a?a:"",developerUrl:null!==(o=null===g||void 0===g?void 0:g.developerUrl)&&void 0!==o?o:"",externalId:null!==(u=e.manifestId)&&void 0!==u?u:"",termsOfUseUrl:null!==(s=null===g||void 0===g?void 0:g.termsOfUseUrl)&&void 0!==s?s:"",privacyUrl:null!==(l=null===g||void 0===g?void 0:g.privacyUrl)&&void 0!==l?l:"",validDomains:null!==(c=null===g||void 0===g?void 0:g.validDomains)&&void 0!==c?c:[],isFullScreen:!1,devicePermissions:[],isFullTrust:null!==(d=null===g||void 0===g?void 0:g.isFullTrust)&&void 0!==d&&d,webApplicationInfo:null===g||void 0===g?void 0:g.webApplicationInfo,inputExtensions:x,showLoadingIndicator:null!==(p=!(null===g||void 0===g||!g.showLoadingIndicator))&&void 0!==p&&p,shortDescription:null===g||void 0===g?void 0:g.shortDescription,longDescription:null===g||void 0===g?void 0:g.longDescription,largeImageUrl:null!==(v=null===g||void 0===g||null===(f=g.iconLarge)||void 0===f?void 0:f.uri)&&void 0!==v?v:"",smallImageUrl:null!==(h=null===g||void 0===g||null===(w=g.iconSmall)||void 0===w?void 0:w.uri)&&void 0!==h?h:"",state:k,name:null!==(y=null===g||void 0===g?void 0:g.name)&&void 0!==y?y:"",titleId:Z}}function c(e){var n;return{appId:null!==(n=null===e||void 0===e?void 0:e.id)&&void 0!==n?n:"",validDomains:(null===e||void 0===e?void 0:e.validDomains)||[],showTabLoadingIndicator:!(null===e||void 0===e||!e.showLoadingIndicator),version:(null===e||void 0===e?void 0:e.version)||""}}function d(e){return"titleId"in e}var p=t(62190),v=12e4,f=1e4,h=6e5,w=3e5,y=12e4,x=3e5,k=function(e){return e[e.BotInvoke=1]="BotInvoke",e[e.OpenAuthWindow=2]="OpenAuthWindow",e[e.VerifyCard=3]="VerifyCard",e[e.GetAppFromAppId=4]="GetAppFromAppId",e[e.GetImage=5]="GetImage",e[e.OpenUrlAction=7]="OpenUrlAction",e[e.AnchorClicked=11]="AnchorClicked",e[e.SSOToken=17]="SSOToken",e[e.InstallApp=18]="InstallApp",e[e.EmbedCard=19]="EmbedCard",e[e.OpenStageView=20]="OpenStageView",e[e.OpenTaskModule=21]="OpenTaskModule",e}({}),g="Unable to get app definition!",Z="No botId found",b="SSO token fetch failed",m="Unable to complete action",I=t(1413),A=t(53748),C=t(52230),S=t(14423);function D(e,n,t){return U.apply(this,arguments)}function U(){return(U=(0,i.Z)((0,r.Z)().mark((function e(n,t,i){var a,o;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=(0,I.Z)((0,I.Z)({},B()),{},{payload:{appId:n,botId:t,requestBody:i}}),e.next=3,(0,C.O$)(k.BotInvoke,a);case 3:return o=e.sent,e.abrupt("return",o);case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function O(e){return T.apply(this,arguments)}function T(){return(T=(0,i.Z)((0,r.Z)().mark((function e(n){var t,i;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=(0,I.Z)((0,I.Z)({},B(y)),{},{payload:{resource:n}}),e.next=3,(0,C.O$)(k.SSOToken,t);case 3:return i=e.sent,e.abrupt("return",i);case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function z(e){return E.apply(this,arguments)}function E(){return(E=(0,i.Z)((0,r.Z)().mark((function e(n){var t,i;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=(0,I.Z)((0,I.Z)({},B()),{},{payload:{appId:n}}),e.next=3,(0,C.O$)(k.GetAppFromAppId,t);case 3:return i=e.sent,e.abrupt("return",i);case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function q(e,n){return N.apply(this,arguments)}function N(){return(N=(0,i.Z)((0,r.Z)().mark((function e(n,t){var i,a,o;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=c(t),a=(0,I.Z)((0,I.Z)({},B(v)),{},{payload:{authConfigUrl:n,hubAppDefinition:i}}),e.next=4,(0,C.O$)(k.OpenAuthWindow,a);case 4:return o=e.sent,e.abrupt("return",o);case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function R(e){return L.apply(this,arguments)}function L(){return(L=(0,i.Z)((0,r.Z)().mark((function e(n){var t,i;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=(0,I.Z)((0,I.Z)({},B(w)),{},{payload:{appId:n}}),e.next=3,(0,C.O$)(k.InstallApp,t);case 3:return i=e.sent,e.abrupt("return",i);case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function M(e,n){return P.apply(this,arguments)}function P(){return(P=(0,i.Z)((0,r.Z)().mark((function e(n,t){var i,a;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=(0,I.Z)((0,I.Z)({},B(x)),{},{payload:(0,I.Z)({appId:null!==(i=t.appId)&&void 0!==i?i:t.deepLinkAppId,botId:n},t.stageInfo)}),e.next=3,(0,C.O$)(k.OpenStageView,a);case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function j(e){return V.apply(this,arguments)}function V(){return(V=(0,i.Z)((0,r.Z)().mark((function e(n){var t;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=(0,I.Z)((0,I.Z)({},B()),{},{payload:{url:n}}),e.next=3,(0,C.O$)(k.OpenUrlAction,t);case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function $(e){return F.apply(this,arguments)}function F(){return(F=(0,i.Z)((0,r.Z)().mark((function e(n){var t,i;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=(0,I.Z)((0,I.Z)({},B()),{},{payload:{appId:n.appId,cardId:n.cardId,contentType:n.cardType,content:n.payload,signature:n.signature,serializedContent:JSON.stringify(n.payload),verificationStatus:n.verificationStatus}}),e.next=3,(0,C.O$)(k.VerifyCard,t);case 3:return i=e.sent,e.abrupt("return",i);case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function G(e){if(!e.composeExtension)throw new p.gz("No compose extensions found");try{var n=e.composeExtension.type;switch(n){case"result":var t=e.composeExtension.attachments,r=null===t||void 0===t?void 0:t[0];if(!r)throw new p.gz("Attachments not defined for successful unfurl");return{cardType:r.contentType,payload:r.content,signature:r.signature,fallbackHtml:r.fallbackHtml};case"silentAuth":return{cardType:"SignInCard",payload:{type:"silentAuth",requiresUserConsent:!1}};case"auth":var i,a=e.composeExtension.suggestedActions,o=null===a||void 0===a||null===(i=a.actions)||void 0===i?void 0:i[0].value;if(!o)throw new p.gz("Url not present for Nominal auth response");return{cardType:"SignInCard",payload:{type:"auth",authUrl:new URL(o)}};default:throw new p.gz("Unknown response type: ".concat(n))}}catch(u){throw new p.gz("Error while parsing the Unfurl response",u)}}function B(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:f;return S.yG&&(e=h),{requestContext:{id:(0,A.u)(),timeoutDurationInMS:e},payload:{}}}var H=function(){function e(){(0,u.Z)(this,e),this.appDefinition=void 0}return(0,s.Z)(e,[{key:"CardChannelProvider",get:function(){return this}},{key:"unfurl",value:function(){var e=(0,i.Z)((0,r.Z)().mark((function e(n,t,i,a){var o,u,s,c,v,f,h,w,y,x;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.appDefinition){e.next=9;break}return e.next=3,z(t);case 3:if(s=e.sent,c=null===s||void 0===s?void 0:s.requestContext.rejectionReason,s&&!c){e.next=7;break}throw new p.gz(null!==c&&void 0!==c?c:g);case 7:v=s.payload,this.appDefinition=d(v)?l(v):v;case 9:if(f=null===(o=this.appDefinition.inputExtensions)||void 0===o||null===(u=o[0])||void 0===u?void 0:u.botId){e.next=12;break}throw new p.gz(Z);case 12:return h={name:"composeExtension/queryLink",value:{url:n.href}},"silentAuth"===a?this.addAuthTokenToRequest(h,void 0,i):this.addAuthTokenToRequest(h,i,void 0),e.next=16,D(t,f,h);case 16:if(w=e.sent,y=null===w||void 0===w?void 0:w.requestContext.rejectionReason,w&&!y){e.next=20;break}throw new p.gz(null!==y&&void 0!==y?y:m);case 20:return x=G(w.payload),e.abrupt("return",x);case 22:case"end":return e.stop()}}),e,this)})));return function(n,t,r,i){return e.apply(this,arguments)}}()},{key:"executeAdaptiveCardAction",value:function(){var e=(0,i.Z)((0,r.Z)().mark((function e(n){var t,i,a,o,u,s,c,v,f,h,w;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=n.cardDetails){e.next=3;break}throw new p.gz("No card details found");case 3:if(this.appDefinition){e.next=12;break}return e.next=6,z(a.appId);case 6:if(o=e.sent,u=null===o||void 0===o?void 0:o.requestContext.rejectionReason,o&&!u){e.next=10;break}throw new p.gz(null!==u&&void 0!==u?u:g);case 10:s=o.payload,this.appDefinition=d(s)?l(s):s;case 12:if(c=null===(t=this.appDefinition.inputExtensions)||void 0===t||null===(i=t[0])||void 0===i?void 0:i.botId){e.next=15;break}throw new p.gz(Z);case 15:return v={name:"adaptiveCard/action",type:"invoke",value:{action:{type:"Action.Execute",id:n.actionProps.id,verb:n.actionProps.verb,data:n.actionProps.data},trigger:n.trigger},cardId:a.cardId,contentType:a.cardType,serializedContent:JSON.stringify(a.payload),signature:a.signature},this.addAuthTokenToRequest(v,n.authCode,n.authToken),e.next=19,D(a.appId,c,v);case 19:if(f=e.sent,h=null===f||void 0===f?void 0:f.requestContext.rejectionReason,f&&!h){e.next=23;break}throw new p.gz(null!==h&&void 0!==h?h:m);case 23:return w=f.payload,e.abrupt("return",{statusCode:String(w.statusCode),content:w.value,contentType:w.type,signature:w.signature});case 25:case"end":return e.stop()}}),e,this)})));return function(n){return e.apply(this,arguments)}}()},{key:"verifyCard",value:function(){var e=(0,i.Z)((0,r.Z)().mark((function e(n){var t,i,a;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n.updateExtension){e.next=2;break}throw new p.gz("Unable to verify without UpdateExtension data");case 2:if("updateExtendedProps"===n.updateExtension.type){e.next=4;break}throw new p.gz("Unable to verify without UpdateExtendedProps type");case 4:return e.next=6,$(n);case 6:if(i=e.sent,a=null===i||void 0===i?void 0:i.requestContext.rejectionReason,i&&!a){e.next=10;break}throw new p.gz(null!==a&&void 0!==a?a:"Unable to verify the card!");case 10:return e.abrupt("return",null===(t=i.payload.cards)||void 0===t?void 0:t[0].verificationStatus);case 11:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}()},{key:"addAuthTokenToRequest",value:function(e,n,t){n&&(e.value.state=n),t&&(e.value.authentication={token:t})}}]),e}(),W=function(){function e(){(0,u.Z)(this,e),this.appDefinition=void 0}return(0,s.Z)(e,[{key:"MetaOSProvider",get:function(){return this}},{key:"getAppDefinition",value:function(){var e=(0,i.Z)((0,r.Z)().mark((function e(n){var t,i,a,o;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.appDefinition){e.next=2;break}return e.abrupt("return",this.appDefinition);case 2:return e.next=4,z(n);case 4:if(t=e.sent,i=null===t||void 0===t?void 0:t.requestContext.rejectionReason,t&&!i){e.next=8;break}throw new p.gz(null!==i&&void 0!==i?i:g);case 8:return a=t.payload,o=d(a)?l(a):a,this.cacheInstalledAppDefinition(o),e.abrupt("return",o);case 12:case"end":return e.stop()}}),e,this)})));return function(n){return e.apply(this,arguments)}}()},{key:"getAppStatus",value:function(){var e=(0,i.Z)((0,r.Z)().mark((function e(n){var t,i;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.appDefinition){e.next=10;break}return e.prev=1,e.next=4,this.getAppDefinition(n);case 4:i=e.sent,e.next=10;break;case 7:return e.prev=7,e.t0=e.catch(1),e.abrupt("return","NotInstalled");case 10:return e.abrupt("return",this.getMetaOSAppInstallStatus(null===(t=i)||void 0===t?void 0:t.state));case 11:case"end":return e.stop()}}),e,this,[[1,7]])})));return function(n){return e.apply(this,arguments)}}()},{key:"getAppInstalledStatus",value:function(){var e=(0,i.Z)((0,r.Z)().mark((function e(n){var t;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getAppStatus(n);case 2:return t="NotAvailable"===(t=e.sent)||"Error"===t?"Unknown":t,e.abrupt("return",t);case 5:case"end":return e.stop()}}),e,this)})));return function(n){return e.apply(this,arguments)}}()},{key:"openAuth",value:function(){var e=(0,i.Z)((0,r.Z)().mark((function e(n,t){var i,a,o,u,s,l,c,d,v;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:u=t.authUrl,s=null!==(i=t.tokenExchangeResourceUri)&&void 0!==i?i:null===(a=this.appDefinition)||void 0===a||null===(o=a.webApplicationInfo)||void 0===o?void 0:o.resource,e.t0=t.type,e.next="auth"===e.t0?5:"silentAuth"===e.t0?14:25;break;case 5:if(u){e.next=7;break}throw new p.gz("No auth url found");case 7:return e.next=9,q(u.href,this.appDefinition);case 9:if(l=e.sent,c=null===l||void 0===l?void 0:l.requestContext.rejectionReason,l&&!c){e.next=13;break}throw new p.gz(null!==c&&void 0!==c?c:b);case 13:return e.abrupt("return",{status:l.payload.success,message:l.payload.result});case 14:if(s&&"string"===typeof s){e.next=16;break}throw new p.gz("No resource url found");case 16:return e.next=18,O(s);case 18:if(d=e.sent,v=null===d||void 0===d?void 0:d.requestContext.rejectionReason,d&&!v){e.next=22;break}throw new p.gz(null!==v&&void 0!==v?v:b);case 22:if(!d.payload.success){e.next=24;break}return e.abrupt("return",{status:!0,message:d.payload.result});case 24:case 25:return e.abrupt("return",{status:!1});case 26:case"end":return e.stop()}}),e,this)})));return function(n,t){return e.apply(this,arguments)}}()},{key:"installApp",value:function(){var e=(0,i.Z)((0,r.Z)().mark((function e(n){var t,i;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,R(n);case 2:return i=e.sent,e.abrupt("return",null!==i&&void 0!==i&&null!==(t=i.payload)&&void 0!==t&&t.success?"Installed":"NotInstalled");case 4:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}()},{key:"openStageView",value:function(){var e=(0,i.Z)((0,r.Z)().mark((function e(n){var t,i,a,o;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.appDefinition){e.next=2;break}return e.abrupt("return");case 2:return o=null!==(t=null===(i=this.appDefinition.inputExtensions)||void 0===i||null===(a=i[0])||void 0===a?void 0:a.botId)&&void 0!==t?t:"",e.next=5,M(o,n);case 5:case"end":return e.stop()}}),e,this)})));return function(n){return e.apply(this,arguments)}}()},{key:"cacheInstalledAppDefinition",value:function(e){"Installed"===this.getMetaOSAppInstallStatus(e.state)&&(this.appDefinition=e)}},{key:"getMetaOSAppInstallStatus",value:function(e){switch(null===e||void 0===e?void 0:e.toLowerCase()){case"adminpreinstalled":case"featured":case"installed":case"installedanddeprecated":case"installedandhidden":case"installedandpermanent":case"preconsented":default:return"Installed";case"blocked":return"Unknown";case"notinstalled":return"NotInstalled"}}}]),e}(),J=function(){function e(){(0,u.Z)(this,e)}return(0,s.Z)(e,[{key:"UrlHandlerProvider",get:function(){return this}},{key:"onClick",value:function(){var e=(0,i.Z)((0,r.Z)().mark((function e(n){return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,j(n.href);case 2:return e.abrupt("return",!0);case 3:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}()}]),e}(),K=t(61960),X=t(88861),Q=t(72791),Y=t(54164),_=t(64201);function ee(){return new H}function ne(){return new W}function te(){return re.apply(this,arguments)}function re(){return(re=(0,i.Z)((0,r.Z)().mark((function e(){var n;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,X.Lh)();case 2:return e.sent?((0,K.cM)("Using CDN code loader."),window||(0,K.cM)("Unable to prepare external dependencies. Window is not defined."),window.React=Q,window.ReactDOM=Y,window.LoopSDK=_,n=a.X):((0,K.cM)("Using NPM code loader."),n=o.j),e.abrupt("return",n);case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ie(){return new J}}}]);
//# sourceMappingURL=fluidHost-cardLoop.508af684.chunk.js.map